machine:
  xcode:
    version: "8.3"

checkout:
  post:
    - ./install.sh

dependencies:
  override:
    - gem install xcpretty
    - gem install fastlane
    - gem install danger
    - gem install danger-xcov
    - gem install danger-junit
    - gem install coveralls
    - brew update
    - brew install ant
    - brew install npm
    - npm install shelljs@0.7.0

test:
  override:
    - ./build/pre-build
    - >
     if [ -n "${NIGHTLY_FULL_REGRESSION}" ]; then
        xcrun instruments -w "${IOS_DEVICE} (${IOS_VERSION}) [" || true;        
        fastlane CI;
     else
        fastlane PR;
     fi
  post:
    - cp test_output/report.junit $CIRCLE_TEST_REPORTS/
    - cp test_output/report.html $CIRCLE_TEST_REPORTS/

general:
  artifacts:
    - slather_output/cobertura.xml
